---
import "@/styles/global.css";
---

<html lang="ko">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />

        <!-- Theme initialization script to prevent FOUC -->
        <script is:inline>
            const getThemePreference = () => {
                if (
                    typeof localStorage !== "undefined" &&
                    localStorage.getItem("theme")
                ) {
                    return localStorage.getItem("theme");
                }
                return window.matchMedia("(prefers-color-scheme: dark)").matches
                    ? "dark"
                    : "light";
            };
            const isDark = getThemePreference() === "dark";
            document.documentElement.classList[isDark ? "add" : "remove"](
                "dark",
            );

            let meta = document.querySelector('meta[name="color-scheme"]');
            meta = document.createElement("meta");
            meta.setAttribute("name", "color-scheme");
            document.head.appendChild(meta);
            meta.setAttribute("content", isDark ? "dark light" : "light dark");

            if (typeof localStorage !== "undefined") {
                const observer = new MutationObserver(() => {
                    const isDark =
                        document.documentElement.classList.contains("dark");
                    localStorage.setItem("theme", isDark ? "dark" : "light");

                    let meta = document.querySelector(
                        'meta[name="color-scheme"]',
                    );
                    if (!meta) {
                        meta = document.createElement("meta");
                        meta.setAttribute("name", "color-scheme");
                        document.head.appendChild(meta);
                    }
                    meta.setAttribute(
                        "content",
                        isDark ? "dark light" : "light dark",
                    );
                });
                observer.observe(document.documentElement, {
                    attributes: true,
                    attributeFilter: ["class"],
                });
            }
        </script>

        <slot name="head" />
    </head>

    <body>
        <slot />
    </body>
</html>
